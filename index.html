<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πÅ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏•‡∏≤‡∏ß</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; }
        #map { height: 100vh; width: 100%; }
        .header-stats { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; gap: 25px; align-items: center; }
        .stat-box { text-align: center; padding: 0 15px; }
        .stat-box:not(:last-child) { border-right: 1px solid rgba(255,255,255,0.2); }
        .stat-number { font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-number.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); -webkit-background-clip: text; }
        .stat-number.red { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); -webkit-background-clip: text; }
        .stat-label { font-size: 12px; color: rgba(255,255,255,0.7); margin-top: 3px; }
        .legend { position: absolute; bottom: 30px; left: 20px; z-index: 1000; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); min-width: 200px; }
        .legend h4 { font-size: 14px; font-weight: 600; color: #1a1a2e; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .legend-item { display: flex; align-items: center; margin: 10px 0; font-size: 13px; color: #555; }
        .legend-icon { width: 24px; height: 24px; border-radius: 50%; margin-right: 12px; display: flex; align-items: center; justify-content: center; font-size: 12px; color: white; font-weight: 600; }
        .legend-icon.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); }
        .legend-icon.red { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); }
        .legend-icon.gray { background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%); }
        .signal-legend { position: absolute; bottom: 30px; right: 20px; z-index: 1000; background: white; padding: 20px; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.15); }
        .signal-legend h4 { font-size: 14px; font-weight: 600; color: #1a1a2e; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; }
        .signal-row { display: flex; align-items: center; gap: 8px; margin: 8px 0; font-size: 12px; }
        .signal-badge { padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 500; }
        .signal-badge.ok { background: #d4edda; color: #155724; }
        .signal-badge.no { background: #f8d7da; color: #721c24; }
        .refresh-btn { position: absolute; top: 20px; right: 20px; z-index: 1000; background: white; border: none; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; font-family: 'Prompt', sans-serif; font-size: 14px; transition: all 0.3s; }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        .edit-btn { position: absolute; top: 20px; left: 20px; z-index: 1000; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102,126,234,0.4); font-family: 'Prompt', sans-serif; font-size: 14px; text-decoration: none; transition: all 0.3s; }
        .edit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(102,126,234,0.5); }
        .info-window { min-width: 280px; font-family: 'Prompt', sans-serif; }
        .info-header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 20px; color: white; }
        .info-title { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .info-subtitle { font-size: 12px; opacity: 0.7; }
        .info-body { padding: 15px 20px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .info-label { color: #888; }
        .info-value { font-weight: 500; color: #333; }
        .signal-grid { display: flex; gap: 8px; margin-top: 15px; }
        .signal-card { flex: 1; text-align: center; padding: 12px 8px; border-radius: 12px; background: #f8f9fa; }
        .signal-card.ok { background: #d4edda; }
        .signal-card.no { background: #f8d7da; }
        .signal-provider { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
        .signal-status { font-size: 18px; }
        .btn-maps { display: block; text-align: center; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; margin-top: 15px; font-size: 13px; }
        .loading { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; gap: 20px; }
        .loading.hidden { display: none; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        .loading-text { color: rgba(255,255,255,0.7); font-size: 14px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .error-box { background: #fff; padding: 30px; border-radius: 16px; text-align: center; max-width: 400px; }
        .error-box h3 { color: #eb3349; margin-bottom: 10px; }
        .error-box p { color: #666; font-size: 14px; margin-bottom: 20px; }
        .error-box button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 14px; cursor: pointer; }
        @media (max-width: 768px) { .header-stats { padding: 12px 15px; gap: 15px; width: 90%; } .stat-number { font-size: 24px; } .legend, .signal-legend { bottom: auto; top: 80px; width: calc(50% - 25px); padding: 15px; font-size: 11px; } .legend { left: 10px; } .signal-legend { right: 10px; } .edit-btn, .refresh-btn { display: none; } }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</div>
    </div>
    
    <div id="map"></div>
    
    <div class="header-stats">
        <div class="stat-box"><div class="stat-number" id="totalCount">0</div><div class="stat-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div></div>
        <div class="stat-box"><div class="stat-number green" id="surveyedCount">0</div><div class="stat-label">‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß</div></div>
        <div class="stat-box"><div class="stat-number red" id="pendingCount">0</div><div class="stat-label">‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à</div></div>
    </div>
    
    <a href="https://docs.google.com/spreadsheets/d/1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg/edit" target="_blank" class="edit-btn">üìù ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Google Sheet</a>
    
    <button class="refresh-btn" onclick="loadData()">üîÑ ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    
    <div class="legend">
        <h4>üó∫Ô∏è ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏™‡∏≥‡∏£‡∏ß‡∏à</h4>
        <div class="legend-item"><div class="legend-icon green">‚úì</div><span>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - AIS ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span></div>
        <div class="legend-item"><div class="legend-icon red">‚úó</div><span>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢</span></div>
        <div class="legend-item"><div class="legend-icon gray">?</div><span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à</span></div>
    </div>
    
    <div class="signal-legend">
        <h4>üì∂ ‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</h4>
        <div class="signal-row"><span style="color:#00a651;font-weight:600;">AIS</span><span class="signal-badge ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span><span class="signal-badge no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span></div>
        <div class="signal-row"><span style="color:#00b2e3;font-weight:600;">DTAC</span><span class="signal-badge ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span><span class="signal-badge no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span></div>
        <div class="signal-row"><span style="color:#eb2227;font-weight:600;">TRUE</span><span class="signal-badge ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span><span class="signal-badge no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span></div>
    </div>

    <script>
        const SHEET_ID = '1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg';
        let map, markers = [], infoWindow, locationsData = [];
        
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 17.5, lng: 104 },
                zoom: 6,
                styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }],
                mapTypeControl: true,
                fullscreenControl: true,
                streetViewControl: false
            });
            infoWindow = new google.maps.InfoWindow();
            loadData();
        }
        
        // Helper function to get cell value safely
        function getCellValue(row, index) {
            if (row.c && row.c[index] && row.c[index].v !== null && row.c[index].v !== undefined) {
                return row.c[index].v;
            }
            return '';
        }
        
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loadingText').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...';
            
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
                const response = await fetch(url);
                const text = await response.text();
                
                console.log("üì• Raw response length:", text.length);
                
                // ‡πÉ‡∏ä‡πâ Regex ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏ß‡∏á‡πÄ‡∏•‡πá‡∏ö (‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Gemini)
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S\w]+)\)/);
                
                if (!match || !match[1]) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                }
                
                const json = JSON.parse(match[1]);
                
                // Debug: ‡πÅ‡∏™‡∏î‡∏á columns ‡πÅ‡∏•‡∏∞‡∏à‡∏≥‡∏ô‡∏ß‡∏ô rows (‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Gemini)
                console.log("üìä json.table:", json.table);
                console.log("üìä Columns:", json.table.cols);
                console.log("üìä Number of rows:", json.table.rows ? json.table.rows.length : 'undefined');
                
                // ‡∏ñ‡πâ‡∏≤‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• row ‡πÅ‡∏£‡∏Å
                if (json.table.rows && json.table.rows.length > 0) {
                    console.log("üìä First row (raw):", json.table.rows[0]);
                    console.log("üìä First row.c:", json.table.rows[0].c);
                    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏ï‡πà‡∏•‡∏∞ cell
                    if (json.table.rows[0].c) {
                        json.table.rows[0].c.forEach((cell, i) => {
                            console.log(`   Cell[${i}]:`, cell?.v, '| formatted:', cell?.f);
                        });
                    }
                }
                
                /*
                 * Column Index ‡∏ï‡∏≤‡∏° Google Sheet:
                 * 0: ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                 * 1: ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô
                 * 2: ‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î
                 * 3: ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î
                 * 4: ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà
                 * 5: ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
                 * 6: ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏õ.
                 * 7: ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•
                 * 8: ‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps
                 * 9: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏£‡∏ß‡∏à
                 * 10: ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à
                 * 11: LAC
                 * 12: CI
                 * 13: AIS
                 * 14: DTAC
                 * 15: True
                 * 16: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û
                 * 17: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠
                 * 18: ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                 */
                
                // Parse rows using column INDEX (‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Gemini)
                locationsData = [];
                json.table.rows.forEach((row, idx) => {
                    const lat = parseFloat(getCellValue(row, 2));  // ‡∏•‡∏∞‡∏ï‡∏¥‡∏à‡∏π‡∏î
                    const lng = parseFloat(getCellValue(row, 3));  // ‡∏•‡∏≠‡∏á‡∏à‡∏¥‡∏à‡∏π‡∏î
                    
                    // Only add if has valid coordinates
                    if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                        locationsData.push({
                            id: getCellValue(row, 0) || idx + 1,       // ‡∏•‡∏≥‡∏î‡∏±‡∏ö
                            name: getCellValue(row, 1) || '',          // ‡∏ä‡∏∑‡πà‡∏≠‡πÇ‡∏•‡πÄ‡∏Ñ‡∏ä‡∏±‡πà‡∏ô
                            lat: lat,
                            lng: lng,
                            freq: getCellValue(row, 4) || 0,           // ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà
                            province: getCellValue(row, 5) || '',      // ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
                            area: getCellValue(row, 6) || '',          // ‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏õ.
                            team: getCellValue(row, 7) || '',          // ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•
                            gmaps: getCellValue(row, 8) || '',         // ‡∏•‡∏¥‡∏á‡∏Å‡πå Google Maps
                            status: getCellValue(row, 9) || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à',  // ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡∏£‡∏ß‡∏à
                            date: getCellValue(row, 10) || '',         // ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à
                            ais: getCellValue(row, 13) || '',          // AIS
                            dtac: getCellValue(row, 14) || '',         // DTAC
                            true_h: getCellValue(row, 15) || '',       // True
                            note: getCellValue(row, 18) || ''          // ‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏
                        });
                    }
                });
                
                console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', locationsData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                console.log('üìç ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•:', locationsData.slice(0, 3));
                
                renderMarkers();
                updateStats();
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('loadingText').innerHTML = `
                    <div class="error-box">
                        <h3>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</h3>
                        <p>Error: ${error.message}</p>
                        <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤ Google Sheet ‡πÑ‡∏î‡πâ‡∏ó‡∏≥ "Publish to web" ‡πÅ‡∏•‡πâ‡∏ß</p>
                        <button onclick="loadData()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                `;
                return;
            }
            
            document.getElementById('loading').classList.add('hidden');
        }
        
        function getIcon(loc) {
            let color = '#95a5a6'; // Gray - not surveyed
            if (loc.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß') {
                color = loc.ais === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? '#11998e' : '#eb3349'; // Green or Red
            }
            return {
                path: google.maps.SymbolPath.CIRCLE,
                fillColor: color,
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 3,
                scale: 12
            };
        }
        
        function createInfo(loc) {
            const gc = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? 'ok' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? 'no' : '');
            const gi = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? '‚úì' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? '‚úó' : '-');
            
            return `
                <div class="info-window">
                    <div class="info-header">
                        <div class="info-title">${loc.name}</div>
                        <div class="info-subtitle">#${loc.id} ‚Ä¢ ${loc.province || '-'}</div>
                    </div>
                    <div class="info-body">
                        <div class="info-row"><span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span><span class="info-value">${loc.status}</span></div>
                        <div class="info-row"><span class="info-label">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà</span><span class="info-value">${loc.area || '-'}</span></div>
                        <div class="info-row"><span class="info-label">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ñ‡∏µ‡πà</span><span class="info-value">${loc.freq || '-'}</span></div>
                        <div class="info-row"><span class="info-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•</span><span class="info-value">${loc.team || '-'}</span></div>
                        <div class="signal-grid">
                            <div class="signal-card ${gc(loc.ais)}">
                                <div class="signal-provider" style="color:#00a651;">AIS</div>
                                <div class="signal-status">${gi(loc.ais)}</div>
                            </div>
                            <div class="signal-card ${gc(loc.dtac)}">
                                <div class="signal-provider" style="color:#00b2e3;">DTAC</div>
                                <div class="signal-status">${gi(loc.dtac)}</div>
                            </div>
                            <div class="signal-card ${gc(loc.true_h)}">
                                <div class="signal-provider" style="color:#eb2227;">TRUE</div>
                                <div class="signal-status">${gi(loc.true_h)}</div>
                            </div>
                        </div>
                        ${loc.note ? `<p style="margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;font-size:12px;color:#666;">${loc.note}</p>` : ''}
                        ${loc.gmaps ? `<a href="${loc.gmaps}" target="_blank" class="btn-maps">üìç ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</a>` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderMarkers() {
            // Clear existing markers
            markers.forEach(m => m.setMap(null));
            markers = [];
            
            const bounds = new google.maps.LatLngBounds();
            
            locationsData.forEach(loc => {
                const position = { lat: loc.lat, lng: loc.lng };
                bounds.extend(position);
                
                const marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: getIcon(loc),
                    title: loc.name
                });
                
                marker.addListener('click', () => {
                    infoWindow.setContent(createInfo(loc));
                    infoWindow.open(map, marker);
                });
                
                markers.push(marker);
            });
            
            if (markers.length > 0) {
                map.fitBounds(bounds);
            }
        }
        
        function updateStats() {
            const total = locationsData.length;
            const surveyed = locationsData.filter(l => l.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß').length;
            const pending = total - surveyed;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('surveyedCount').textContent = surveyed;
            document.getElementById('pendingCount').textContent = pending;
        }
        
        window.initMap = initMap;
    </script>
    
    <!-- Google Maps API with async defer (‡∏ï‡∏≤‡∏°‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥ Gemini) -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtMkrEmWVIp6IW6vkZ9A-7vjQKc8njTOA&callback=initMap"></script>
</body>
</html>
