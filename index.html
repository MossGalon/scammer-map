<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πÅ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏•‡∏≤‡∏ß</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Header Stats */
        .header-stats { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; gap: 25px; align-items: center; }
        .stat-box { text-align: center; padding: 0 15px; }
        .stat-box:not(:last-child) { border-right: 1px solid rgba(255,255,255,0.2); }
        .stat-number { font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-number.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); -webkit-background-clip: text; }
        .stat-number.orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; }
        .stat-number.gray { background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%); -webkit-background-clip: text; }
        .stat-label { font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 3px; }
        
        /* Legend - Redesigned */
        .legend {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            min-width: 280px;
        }
        .legend h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .legend-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .legend-section-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 13px;
            color: #333;
        }
        .legend-marker {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: 700;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .legend-marker.green { background: #11998e; }
        .legend-marker.orange { background: #f5576c; }
        .legend-marker.gray { background: #95a5a6; }
        .legend-text {
            flex: 1;
        }
        .legend-text strong {
            display: block;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .legend-text span {
            font-size: 11px;
            color: #888;
        }
        
        /* Signal Legend */
        .signal-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
        }
        .signal-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 12px;
        }
        .signal-provider {
            font-weight: 600;
            width: 50px;
        }
        .signal-icons {
            display: flex;
            gap: 15px;
        }
        .signal-icons span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .sig-ok { color: #11998e; }
        .sig-no { color: #f5576c; }
        
        /* Buttons */
        .refresh-btn { position: absolute; top: 20px; right: 20px; z-index: 1000; background: white; border: none; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; font-family: 'Prompt', sans-serif; font-size: 14px; transition: all 0.3s; }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        
        /* ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ */
        .search-box {
            position: absolute;
            top: 20px;
            right: 140px;
            z-index: 1000;
            display: flex;
            gap: 5px;
        }
        .search-input {
            padding: 12px 15px;
            border: none;
            border-radius: 12px;
            font-family: 'Prompt', sans-serif;
            font-size: 14px;
            width: 180px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            outline: none;
        }
        .search-input:focus {
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }
        .search-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            box-shadow: 0 4px 15px rgba(102,126,234,0.4);
        }
        .search-btn:hover {
            transform: translateY(-2px);
        }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î */
        .ruler-btn { 
            position: absolute; 
            top: 20px; 
            right: 350px; 
            z-index: 1000; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white;
            border: none; 
            padding: 12px 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(102,126,234,0.4); 
            cursor: pointer; 
            font-family: 'Prompt', sans-serif; 
            font-size: 14px; 
            transition: all 0.3s; 
        }
        .ruler-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(102,126,234,0.5); }
        .ruler-btn.active { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); box-shadow: 0 4px 15px rgba(235,51,73,0.4); }
        
        .ruler-info {
            position: absolute;
            top: 80px;
            right: 20px;
            z-index: 1000;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            font-size: 14px;
            display: none;
        }
        .ruler-info.show { display: block; }
        .ruler-info .distance { font-size: 24px; font-weight: 700; color: #667eea; }
        .ruler-info .hint { font-size: 12px; color: #666; margin-top: 5px; }
        
        .search-results {
            position: absolute;
            top: 60px;
            right: 140px;
            z-index: 1000;
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
            max-height: 300px;
            overflow-y: auto;
            display: none;
            min-width: 250px;
        }
        .search-results.show { display: block; }
        .search-result-item {
            padding: 12px 15px;
            cursor: pointer;
            border-bottom: 1px solid #eee;
            font-size: 13px;
        }
        .search-result-item:hover {
            background: #f8f9fa;
        }
        .search-result-item:last-child {
            border-bottom: none;
        }
        .search-result-id {
            font-weight: 600;
            color: #667eea;
        }
        .search-result-name {
            color: #666;
            font-size: 12px;
        }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ã‡πà‡∏≠‡∏ô UI */
        .hide-ui-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 1001;
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            cursor: pointer;
            font-family: 'Prompt', sans-serif;
            font-size: 13px;
            transition: all 0.3s;
        }
        .hide-ui-btn:hover { background: rgba(0,0,0,0.9); }
        .hide-ui-btn.active { background: #27ae60; }
        
        /* ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏ã‡πà‡∏≠‡∏ô UI */
        .ui-hidden .header-stats,
        .ui-hidden .legend,
        .ui-hidden .search-box,
        .ui-hidden .search-results,
        .ui-hidden .ruler-btn,
        .ui-hidden .ruler-info,
        .ui-hidden .refresh-btn,
        .ui-hidden .edit-btn { 
            display: none !important; 
        }
        .edit-btn { position: absolute; top: 20px; left: 20px; z-index: 1000; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102,126,234,0.4); font-family: 'Prompt', sans-serif; font-size: 14px; text-decoration: none; transition: all 0.3s; }
        .edit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(102,126,234,0.5); }
        
        /* Info Window */
        .info-window { min-width: 300px; font-family: 'Prompt', sans-serif; }
        .info-header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 20px; color: white; border-radius: 12px 12px 0 0; }
        .info-title { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .info-subtitle { font-size: 12px; opacity: 0.7; }
        .info-body { padding: 15px 20px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .info-label { color: #888; }
        .info-value { font-weight: 500; color: #333; }
        .signal-grid { display: flex; gap: 8px; margin-top: 15px; }
        .signal-card { flex: 1; text-align: center; padding: 12px 8px; border-radius: 12px; background: #f8f9fa; }
        .signal-card.ok { background: #d4edda; }
        .signal-card.no { background: #f8d7da; }
        td.ok { color: #11998e; font-weight: bold; }
        td.no { color: #f5576c; font-weight: bold; }
        .signal-card-provider { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
        .signal-status { font-size: 18px; }
        .btn-maps { display: block; text-align: center; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; margin-top: 15px; font-size: 13px; }
        
        /* Loading */
        .loading { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; gap: 20px; }
        .loading.hidden { display: none; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        .loading-text { color: rgba(255,255,255,0.7); font-size: 14px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .error-box { background: #fff; padding: 30px; border-radius: 16px; text-align: center; max-width: 400px; }
        .error-box h3 { color: #eb3349; margin-bottom: 10px; }
        .error-box p { color: #666; font-size: 14px; margin-bottom: 20px; }
        .error-box button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 14px; cursor: pointer; }
        
        /* Custom Marker Label */
        .marker-label {
            background: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            white-space: nowrap;
            border: 2px solid;
        }
        .marker-label.green { border-color: #11998e; color: #11998e; }
        .marker-label.orange { border-color: #f5576c; color: #f5576c; }
        .marker-label.gray { border-color: #95a5a6; color: #95a5a6; }
        
        .legend h4 small { display: none; }
        
        @media (max-width: 768px) { 
            /* Header Stats ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
            .header-stats { 
                padding: 8px 10px; 
                gap: 8px; 
                width: 95%; 
                top: 10px;
                border-radius: 12px;
            } 
            .stat-box { padding: 0 8px; }
            .stat-number { font-size: 18px; } 
            .stat-label { font-size: 9px; line-height: 1.2; }
            
            /* Legend ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
            .legend {
                bottom: 20px;
                left: 10px;
                right: auto;
                top: auto;
                width: auto;
                max-width: 200px;
                max-height: 45px;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
                min-width: 0;
                padding: 10px 12px;
                cursor: pointer;
            }
            .legend.active {
                max-height: 350px;
                max-width: 280px;
                overflow-y: auto;
            }
            .legend.active h4::after {
                content: ' ‚ñ¥';
            }
            .legend h4 { font-size: 13px; margin-bottom: 0; }
            .legend.active h4 { margin-bottom: 12px; }
            .legend h4 small { display: inline; }
            .legend h4::after {
                content: ' ‚ñæ';
            }
            .legend-section { margin-bottom: 8px; padding-bottom: 8px; }
            .legend-section-title { font-size: 10px; margin-bottom: 6px; }
            .legend-item { margin: 5px 0; }
            .legend-marker { width: 22px; height: 22px; font-size: 10px; margin-right: 8px; border-width: 2px; }
            .legend-text strong { font-size: 11px; }
            .legend-text span { font-size: 9px; }
            .signal-box { padding: 6px; margin-top: 6px; }
            .signal-row { font-size: 10px; padding: 3px 0; }
            .signal-provider { width: 40px; }
            
            /* ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
            .edit-btn { 
                left: auto;
                right: 70px; 
                bottom: 25px; 
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .edit-btn span { display: none; }
            .refresh-btn { 
                right: 15px; 
                bottom: 25px; 
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .refresh-btn span { display: none; }
            
            /* ‡∏ä‡πà‡∏≠‡∏á‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ mobile */
            .search-box {
                right: 70px;
                top: auto;
                bottom: 80px;
            }
            .search-input {
                width: 150px;
                padding: 10px 12px;
                font-size: 13px;
            }
            .search-btn {
                padding: 10px 12px;
            }
            .search-results {
                right: 10px;
                left: 10px;
                bottom: 130px;
                top: auto;
            }
            
            /* ‡∏õ‡∏∏‡πà‡∏°‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î mobile */
            .ruler-btn {
                right: 125px;
                bottom: 25px;
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .ruler-btn span { display: none; }
            
            .ruler-info {
                top: auto;
                bottom: 80px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
            
            .hide-ui-btn {
                top: auto;
                bottom: 25px;
                left: 15px;
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</div>
    </div>
    
    <div id="map"></div>
    
    <div class="header-stats">
        <div class="stat-box">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="stat-box">
            <div class="stat-number green" id="surveyedOkCount">0</div>
            <div class="stat-label">‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì<br>‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ</div>
        </div>
        <div class="stat-box">
            <div class="stat-number orange" id="surveyedNoCount">0</div>
            <div class="stat-label">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì<br>‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢</div>
        </div>
        <div class="stat-box">
            <div class="stat-number gray" id="pendingCount">0</div>
            <div class="stat-label">‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à</div>
        </div>
    </div>
    
    <a href="https://docs.google.com/spreadsheets/d/1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg/edit" target="_blank" class="edit-btn">üìù<span> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></a>
    
    <button class="refresh-btn" onclick="loadData()">üîÑ<span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span></button>
    
    <div class="search-box">
        <input type="text" class="search-input" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ A1, L5..." onkeyup="searchLocations()" onfocus="showSearchResults()">
        <button class="search-btn" onclick="searchLocations()">üîç</button>
    </div>
    <div class="search-results" id="searchResults"></div>
    
    <button class="ruler-btn" onclick="toggleRuler()">üìê<span> ‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</span></button>
    
    <div class="ruler-info" id="rulerInfo">
        <div class="distance" id="rulerDistance">0.00 km</div>
        <div class="hint" id="rulerHint">‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡πÅ‡∏£‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà</div>
    </div>
    
    <button class="hide-ui-btn" onclick="toggleUI()">üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô UI</button>
    
    <div class="legend" onclick="this.classList.toggle('active')">
        <h4>üìç ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà <small style="font-weight:normal;font-size:11px;opacity:0.6;">(‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π)</small></h4>
        
        <div class="legend-section">
            <div class="legend-section-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏µ</div>
            
            <div class="legend-item">
                <div class="legend-marker green">‚úì</div>
                <div class="legend-text">
                    <strong>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</strong>
                    <span>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ</span>
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-marker orange">‚úó</div>
                <div class="legend-text">
                    <strong>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</strong>
                    <span>‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ</span>
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-marker gray">?</div>
                <div class="legend-text">
                    <strong>‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à</strong>
                    <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</span>
                </div>
            </div>
        </div>
        
        <div class="legend-section">
            <div class="legend-section-title">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π)</div>
            <div class="signal-box">
                <div class="signal-row" style="font-weight:600;border-bottom:1px solid #ddd;padding-bottom:6px;margin-bottom:6px;">
                    <span style="width:50px;">‡∏Ñ‡πà‡∏≤‡∏¢</span>
                    <div class="signal-icons">
                        <span>üìû ‡πÇ‡∏ó‡∏£</span>
                        <span>üåê ‡πÄ‡∏ô‡πá‡∏ï</span>
                    </div>
                </div>
                <div class="signal-row">
                    <span class="signal-provider" style="color:#00a651;">AIS</span>
                    <div class="signal-icons">
                        <span class="sig-ok">‚úì</span>
                        <span class="sig-ok">‚úì</span>
                    </div>
                </div>
                <div class="signal-row">
                    <span class="signal-provider" style="color:#00b2e3;">DTAC</span>
                    <div class="signal-icons">
                        <span class="sig-no">‚úó</span>
                        <span class="sig-no">‚úó</span>
                    </div>
                </div>
                <div class="signal-row">
                    <span class="signal-provider" style="color:#eb2227;">TRUE</span>
                    <div class="signal-icons">
                        <span class="sig-no">‚úó</span>
                        <span class="sig-no">‚úó</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg';
        let map, markers = [], infoWindow, locationsData = [];
        
        // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡πÑ‡∏ó‡∏¢ (‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡πÑ‡∏ó‡∏¢‡∏£‡∏¥‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÇ‡∏Ç‡∏á) - ‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏•‡∏á‡πÉ‡∏ï‡πâ
const THAI_BORDER = [
            { lat: 20.445006, lng: 99.937135 },
            { lat: 20.436273, lng: 99.952379 },
            { lat: 20.417825, lng: 99.961113 },
            { lat: 20.400823, lng: 99.974342 },
            { lat: 20.383511, lng: 99.996718 },
            { lat: 20.380773, lng: 100.022918 },
            { lat: 20.364779, lng: 100.042658 },
            { lat: 20.344186, lng: 100.055474 },
            { lat: 20.283233, lng: 100.097280 },
            { lat: 20.248016, lng: 100.116607 },
            { lat: 20.239153, lng: 100.152522 },
            { lat: 20.292613, lng: 100.167095 },
            { lat: 20.302483, lng: 100.179497 },
            { lat: 20.311139, lng: 100.207196 },
            { lat: 20.348992, lng: 100.220683 },
            { lat: 20.391831, lng: 100.270241 },
            { lat: 20.389971, lng: 100.344345 },
            { lat: 20.250186, lng: 100.421601 },
            { lat: 20.210240, lng: 100.452142 },
            { lat: 20.190707, lng: 100.461030 },
            { lat: 20.178769, lng: 100.485628 },
            { lat: 20.164868, lng: 100.496377 },
            { lat: 20.149727, lng: 100.529243 },
            { lat: 20.166729, lng: 100.541956 },
            { lat: 20.158021, lng: 100.548674 },
            { lat: 20.066580, lng: 100.543351 },
            { lat: 19.931653, lng: 100.492656 },
            { lat: 19.880700, lng: 100.483975 },
            { lat: 19.859771, lng: 100.465630 },
            { lat: 19.847213, lng: 100.438448 },
            { lat: 19.810446, lng: 100.420516 },
            { lat: 19.763859, lng: 100.383516 },
            { lat: 19.732001, lng: 100.383826 },
            { lat: 19.711640, lng: 100.400466 },
            { lat: 19.684252, lng: 100.410491 },
            { lat: 19.634358, lng: 100.418862 },
            { lat: 19.597771, lng: 100.447491 },
            { lat: 19.568057, lng: 100.458963 },
            { lat: 19.537103, lng: 100.461960 },
            { lat: 19.514469, lng: 100.491829 },
            { lat: 19.494548, lng: 100.549294 },
            { lat: 19.508347, lng: 100.574758 },
            { lat: 19.540927, lng: 100.607016 },
            { lat: 19.512454, lng: 100.714762 },
            { lat: 19.495039, lng: 100.738171 },
            { lat: 19.482429, lng: 100.753002 },
            { lat: 19.536535, lng: 100.808451 },
            { lat: 19.602603, lng: 100.861213 },
            { lat: 19.612912, lng: 100.874597 },
            { lat: 19.612447, lng: 100.885656 },
            { lat: 19.610613, lng: 101.002548 },
            { lat: 19.577126, lng: 101.068228 },
            { lat: 19.565112, lng: 101.124659 },
            { lat: 19.574750, lng: 101.176852 },
            { lat: 19.586867, lng: 101.197316 },
            { lat: 19.585214, lng: 101.225015 },
            { lat: 19.570280, lng: 101.246202 },
            { lat: 19.547154, lng: 101.254884 },
            { lat: 19.494444, lng: 101.251731 },
            { lat: 19.466358, lng: 101.215300 },
            { lat: 19.417214, lng: 101.177782 },
            { lat: 19.346624, lng: 101.178454 },
            { lat: 19.338666, lng: 101.201967 },
            { lat: 19.326367, lng: 101.211269 },
            { lat: 19.315592, lng: 101.209253 },
            { lat: 19.225804, lng: 101.229872 },
            { lat: 19.143587, lng: 101.229149 },
            { lat: 19.115785, lng: 101.247442 },
            { lat: 19.050130, lng: 101.317877 },
            { lat: 18.981478, lng: 101.283926 },
            { lat: 18.934453, lng: 101.267286 },
            { lat: 18.892724, lng: 101.232921 },
            { lat: 18.855491, lng: 101.223309 },
            { lat: 18.778545, lng: 101.223981 },
            { lat: 18.730072, lng: 101.205843 },
            { lat: 18.689481, lng: 101.234782 },
            { lat: 18.658449, lng: 101.234730 },
            { lat: 18.616797, lng: 101.194112 },
            { lat: 18.606359, lng: 101.167757 },
            { lat: 18.589977, lng: 101.158145 },
            { lat: 18.556724, lng: 101.155355 },
            { lat: 18.510422, lng: 101.077892 },
            { lat: 18.495668, lng: 101.071949 },
            { lat: 18.447842, lng: 101.035621 },
            { lat: 18.410453, lng: 101.037016 },
            { lat: 18.371613, lng: 101.074089 },
            { lat: 18.336246, lng: 101.145536 },
            { lat: 18.316377, lng: 101.152409 },
            { lat: 18.291159, lng: 101.130137 },
            { lat: 18.245735, lng: 101.128380 },
            { lat: 18.218708, lng: 101.139645 },
            { lat: 18.209070, lng: 101.152771 },
            { lat: 18.195299, lng: 101.162796 },
            { lat: 18.141943, lng: 101.145640 },
            { lat: 18.104736, lng: 101.144968 },
            { lat: 18.053421, lng: 101.165173 },
            { lat: 18.021330, lng: 101.125434 },
            { lat: 17.984381, lng: 101.094893 },
            { lat: 17.933997, lng: 101.066161 },
            { lat: 17.895240, lng: 101.008284 },
            { lat: 17.864595, lng: 100.997122 },
            { lat: 17.817725, lng: 100.994796 },
            { lat: 17.803824, lng: 100.967046 },
            { lat: 17.791008, lng: 100.967718 },
            { lat: 17.781913, lng: 100.975211 },
            { lat: 17.777624, lng: 100.975211 },
            { lat: 17.770596, lng: 100.964876 },
            { lat: 17.755920, lng: 100.956401 },
            { lat: 17.725586, lng: 100.960690 },
            { lat: 17.699799, lng: 100.953817 },
            { lat: 17.616962, lng: 100.899453 },
            { lat: 17.573761, lng: 100.886017 },
            { lat: 17.555486, lng: 100.937738 },
            { lat: 17.538207, lng: 101.000842 },
            { lat: 17.512627, lng: 101.035466 },
            { lat: 17.492215, lng: 101.066161 },
            { lat: 17.463948, lng: 101.124659 },
            { lat: 17.461674, lng: 101.132307 },
            { lat: 17.472475, lng: 101.147190 },
            { lat: 17.510612, lng: 101.166724 },
            { lat: 17.518725, lng: 101.190288 },
            { lat: 17.531282, lng: 101.208530 },
            { lat: 17.592157, lng: 101.247029 },
            { lat: 17.683160, lng: 101.369864 },
            { lat: 17.684916, lng: 101.383765 },
            { lat: 17.709463, lng: 101.403092 },
            { lat: 17.717163, lng: 101.398751 },
            { lat: 17.720728, lng: 101.381904 },
            { lat: 17.733751, lng: 101.401851 },
            { lat: 17.733596, lng: 101.432030 },
            { lat: 17.749254, lng: 101.449807 },
            { lat: 17.750184, lng: 101.456060 },
            { lat: 17.739487, lng: 101.459109 },
            { lat: 17.722589, lng: 101.470426 },
            { lat: 17.737988, lng: 101.479004 },
            { lat: 17.765377, lng: 101.502724 },
            { lat: 17.792145, lng: 101.556261 },
            { lat: 17.813672, lng: 101.545505 },
            { lat: 17.828887, lng: 101.570523 },
            { lat: 17.852917, lng: 101.577551 },
            { lat: 17.854363, lng: 101.600392 },
            { lat: 17.884646, lng: 101.619874 },
            { lat: 17.912189, lng: 101.729067 },
            { lat: 17.997817, lng: 101.756920 },
            { lat: 18.058563, lng: 101.773922 },
            { lat: 18.073575, lng: 101.796659 },
            { lat: 18.052129, lng: 101.845184 },
            { lat: 18.037117, lng: 101.904301 },
            { lat: 18.208502, lng: 102.071268 },
            { lat: 18.212377, lng: 102.107385 },
            { lat: 18.200286, lng: 102.171934 },
            { lat: 18.169228, lng: 102.182114 },
            { lat: 18.131608, lng: 102.221801 },
            { lat: 18.124166, lng: 102.233119 },
            { lat: 18.051457, lng: 102.306706 },
            { lat: 18.038797, lng: 102.366392 },
            { lat: 17.994200, lng: 102.412229 },
            { lat: 17.971152, lng: 102.482044 },
            { lat: 17.955184, lng: 102.599608 },
            { lat: 17.850074, lng: 102.595577 },
            { lat: 17.837000, lng: 102.609426 },
            { lat: 17.810077, lng: 102.682910 },
            { lat: 17.831781, lng: 102.673350 },
            { lat: 17.865370, lng: 102.672988 },
            { lat: 17.881804, lng: 102.722184 },
            { lat: 17.922731, lng: 102.774067 },
            { lat: 17.963762, lng: 102.838043 },
            { lat: 18.008928, lng: 102.938605 },
            { lat: 18.007739, lng: 102.972918 },
            { lat: 17.984226, lng: 103.020461 },
            { lat: 18.005000, lng: 103.049399 },
            { lat: 18.025774, lng: 103.068210 },
            { lat: 18.094039, lng: 103.064799 },
            { lat: 18.125561, lng: 103.071310 },
            { lat: 18.138667, lng: 103.087703 },
            { lat: 18.141194, lng: 103.092756 },
            { lat: 18.136165, lng: 103.090087 },
            { lat: 18.134786, lng: 103.089087 },
            { lat: 18.151865, lng: 103.126656 },
            { lat: 18.188012, lng: 103.145104 },
            { lat: 18.237028, lng: 103.157300 },
            { lat: 18.254856, lng: 103.176730 },
            { lat: 18.262297, lng: 103.214919 },
            { lat: 18.276069, lng: 103.273520 },
            { lat: 18.287774, lng: 103.295379 },
            { lat: 18.305137, lng: 103.290418 },
            { lat: 18.335988, lng: 103.240189 },
            { lat: 18.345264, lng: 103.235331 },
            { lat: 18.355780, lng: 103.233988 },
            { lat: 18.400196, lng: 103.260756 },
            { lat: 18.425672, lng: 103.306851 },
            { lat: 18.441408, lng: 103.396768 },
            { lat: 18.421978, lng: 103.469942 },
            { lat: 18.424432, lng: 103.489114 },
            { lat: 18.417688, lng: 103.523169 },
            { lat: 18.400403, lng: 103.607143 },
            { lat: 18.383220, lng: 103.629932 },
            { lat: 18.353222, lng: 103.695562 },
            { lat: 18.346685, lng: 103.767185 },
            { lat: 18.338262, lng: 103.801395 },
            { lat: 18.320666, lng: 103.832091 },
            { lat: 18.296352, lng: 103.848989 },
            { lat: 18.283226, lng: 103.873949 },
            { lat: 18.286999, lng: 103.885938 },
            { lat: 18.297256, lng: 103.893689 },
            { lat: 18.327591, lng: 103.929294 },
            { lat: 18.330665, lng: 103.975441 },
            { lat: 18.299117, lng: 104.018643 },
            { lat: 18.114554, lng: 104.110937 },
            { lat: 18.079673, lng: 104.135690 },
            { lat: 18.018644, lng: 104.203329 },
            { lat: 17.914980, lng: 104.255114 },
            { lat: 17.874001, lng: 104.270307 },
            { lat: 17.861488, lng: 104.281982 },
            { lat: 17.819327, lng: 104.352627 },
            { lat: 17.757160, lng: 104.390300 },
            { lat: 17.733699, lng: 104.408903 },
            { lat: 17.707602, lng: 104.417843 },
            { lat: 17.665951, lng: 104.452001 },
            { lat: 17.562443, lng: 104.636383 },
            { lat: 17.527304, lng: 104.702632 },
            { lat: 17.486892, lng: 104.734258 },
            { lat: 17.449944, lng: 104.756789 },
            { lat: 17.435268, lng: 104.781645 },
            { lat: 17.423485, lng: 104.792704 },
            { lat: 17.361060, lng: 104.819317 },
            { lat: 17.300082, lng: 104.816423 },
            { lat: 17.194042, lng: 104.814460 },
            { lat: 17.024802, lng: 104.745317 },
            { lat: 16.943532, lng: 104.746340 },
            { lat: 16.899848, lng: 104.753016 },
            { lat: 16.868170, lng: 104.766401 },
            { lat: 16.844658, lng: 104.765212 },
            { lat: 16.818895, lng: 104.757910 },
            { lat: 16.798459, lng: 104.756789 },
            { lat: 16.704873, lng: 104.779010 },
            { lat: 16.656762, lng: 104.763713 },
            { lat: 16.571909, lng: 104.748417 },
            { lat: 16.528915, lng: 104.754515 },
            { lat: 16.497082, lng: 104.782730 },
            { lat: 16.454087, lng: 104.855491 },
            { lat: 16.421841, lng: 104.879469 },
            { lat: 16.372749, lng: 104.897039 },
            { lat: 16.353370, lng: 104.908046 },
            { lat: 16.330839, lng: 104.944064 },
            { lat: 16.304329, lng: 104.971504 },
            { lat: 16.293963, lng: 104.988028 },
            { lat: 16.276734, lng: 105.015481 },
            { lat: 16.236013, lng: 105.029744 },
            { lat: 16.165268, lng: 105.032586 },
            { lat: 16.121188, lng: 105.058114 },
            { lat: 16.095853, lng: 105.106979 },
            { lat: 16.049151, lng: 105.247405 },
            { lat: 16.018817, lng: 105.404915 },
            { lat: 16.009877, lng: 105.422071 },
            { lat: 16.002125, lng: 105.423932 },
            { lat: 15.988896, lng: 105.407395 },
            { lat: 15.954790, lng: 105.362488 },
            { lat: 15.882132, lng: 105.372565 },
            { lat: 15.783896, lng: 105.423001 },
            { lat: 15.764879, lng: 105.447961 },
            { lat: 15.766171, lng: 105.503410 },
            { lat: 15.749376, lng: 105.568522 },
            { lat: 15.681990, lng: 105.640921 },
            { lat: 15.583313, lng: 105.640869 },
            { lat: 15.499468, lng: 105.612034 },
            { lat: 15.439214, lng: 105.604282 },
            { lat: 15.423788, lng: 105.588366 },
            { lat: 15.387589, lng: 105.506200 },
            { lat: 15.352811, lng: 105.477468 },
            { lat: 15.324673, lng: 105.499017 },
            { lat: 15.321521, lng: 105.538550 },
            { lat: 15.320901, lng: 105.561494 },
            { lat: 15.272531, lng: 105.563975 },
            { lat: 15.252894, lng: 105.531574 },
            { lat: 15.189436, lng: 105.463102 },
            { lat: 15.155303, lng: 105.447703 },
            { lat: 15.111353, lng: 105.443620 },
            { lat: 15.090630, lng: 105.473851 },
            { lat: 15.064896, lng: 105.503565 },
            { lat: 15.066136, lng: 105.520877 },
            { lat: 15.050039, lng: 105.522840 },
            { lat: 15.005338, lng: 105.553536 },
            { lat: 14.995933, lng: 105.566352 },
            { lat: 14.990792, lng: 105.593068 },
            { lat: 14.953094, lng: 105.543924 },
            { lat: 14.902296, lng: 105.550642 },
            { lat: 14.878034, lng: 105.537620 },
            { lat: 14.877672, lng: 105.517776 },
            { lat: 14.856536, lng: 105.516949 },
            { lat: 14.837235, lng: 105.524390 },
            { lat: 14.830414, lng: 105.506200 },
            { lat: 14.808994, lng: 105.493850 },
            { lat: 14.763803, lng: 105.490697 },
            { lat: 14.736363, lng: 105.505115 },
            { lat: 14.659881, lng: 105.495762 },
            { lat: 14.564048, lng: 105.507544 },
        ];
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á Haversine
        function haversineDistance(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô (line segment)
        function nearestPointOnSegment(px, py, ax, ay, bx, by) {
            const dx = bx - ax;
            const dy = by - ay;
            if (dx === 0 && dy === 0) {
                return { lat: ay, lng: ax };
            }
            const t = Math.max(0, Math.min(1, ((px - ax) * dx + (py - ay) * dy) / (dx * dx + dy * dy)));
            return {
                lat: ay + t * dy,
                lng: ax + t * dx
            };
        }
        
        // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        function findNearestBorderPoint(lat, lng) {
            let nearestPoint = null;
            let minDistance = Infinity;
            
            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å segment ‡∏Ç‡∏≠‡∏á‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
            for (let i = 0; i < THAI_BORDER.length - 1; i++) {
                const a = THAI_BORDER[i];
                const b = THAI_BORDER[i + 1];
                
                // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô segment ‡∏ô‡∏µ‡πâ
                const nearest = nearestPointOnSegment(lng, lat, a.lng, a.lat, b.lng, b.lat);
                const dist = haversineDistance(lat, lng, nearest.lat, nearest.lng);
                
                if (dist < minDistance) {
                    minDistance = dist;
                    nearestPoint = nearest;
                }
            }
            
            return { point: nearestPoint, distance: minDistance };
        }
        
        // ===== ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏∏‡∏î =====
        function searchLocations() {
            const query = document.getElementById('searchInput').value.toLowerCase().trim();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                resultsDiv.classList.remove('show');
                return;
            }
            
            const filtered = locationsData.filter(loc => {
                const idCode = (loc.name.match(/^[AL]\d+/) || [''])[0].toLowerCase();
                return idCode.includes(query) || 
                       loc.name.toLowerCase().includes(query) ||
                       (loc.province && loc.province.toLowerCase().includes(query));
            });
            
            if (filtered.length === 0) {
                resultsDiv.innerHTML = '<div class="search-result-item">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå</div>';
            } else {
                resultsDiv.innerHTML = filtered.map(loc => {
                    const idCode = (loc.name.match(/^[AL]\d+/) || [loc.id])[0];
                    return `
                        <div class="search-result-item" onclick="goToLocation(${loc.lat}, ${loc.lng}, '${loc.name.replace(/'/g, "\\'")}')">
                            <span class="search-result-id">${idCode}</span>
                            <div class="search-result-name">${loc.name} (${loc.province || '-'})</div>
                        </div>
                    `;
                }).join('');
            }
            
            resultsDiv.classList.add('show');
        }
        
        function showSearchResults() {
            const query = document.getElementById('searchInput').value.trim();
            if (query) {
                searchLocations();
            }
        }
        
        function goToLocation(lat, lng, name) {
            map.setCenter({ lat, lng });
            map.setZoom(14);
            document.getElementById('searchResults').classList.remove('show');
            document.getElementById('searchInput').value = '';
            
            // ‡∏´‡∏≤ marker ‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏¥‡∏î info window
            const loc = locationsData.find(l => l.lat === lat && l.lng === lng);
            if (loc) {
                const markerObj = markers.find(m => {
                    const pos = m.marker.getPosition();
                    return pos.lat() === lat && pos.lng() === lng;
                });
                if (markerObj) {
                    infoWindow.setContent(createInfo(loc));
                    infoWindow.open(map, markerObj.marker);
                }
            }
        }
        
        // ‡∏õ‡∏¥‡∏î search results ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô
        document.addEventListener('click', function(e) {
            if (!e.target.closest('.search-box') && !e.target.closest('.search-results')) {
                document.getElementById('searchResults').classList.remove('show');
            }
        });
        
        // ===== ‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞ =====
        let rulerActive = false;
        let rulerPoints = [];
        let rulerMarkers = [];
        let rulerLine = null;
        let rulerClickListener = null;
        
        function toggleRuler() {
            const btn = document.querySelector('.ruler-btn');
            const info = document.getElementById('rulerInfo');
            
            if (rulerActive) {
                clearRuler();
                btn.classList.remove('active');
                btn.innerHTML = 'üìê<span> ‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î</span>';
                info.classList.remove('show');
                if (rulerClickListener) {
                    google.maps.event.removeListener(rulerClickListener);
                    rulerClickListener = null;
                }
            } else {
                btn.classList.add('active');
                btn.innerHTML = '‚ùå<span> ‡∏õ‡∏¥‡∏î</span>';
                info.classList.add('show');
                document.getElementById('rulerHint').textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡πÅ‡∏£‡∏Å‡∏ö‡∏ô‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà';
                document.getElementById('rulerDistance').textContent = '0.00 km';
                rulerClickListener = map.addListener('click', onRulerClick);
            }
            
            rulerActive = !rulerActive;
        }
        
        function onRulerClick(e) {
            const lat = e.latLng.lat();
            const lng = e.latLng.lng();
            
            const marker = new google.maps.Marker({
                position: { lat, lng },
                map: map,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    scale: 10,
                    fillColor: '#667eea',
                    fillOpacity: 1,
                    strokeColor: '#fff',
                    strokeWeight: 3
                },
                label: {
                    text: (rulerPoints.length + 1).toString(),
                    color: '#fff',
                    fontSize: '12px',
                    fontWeight: 'bold'
                }
            });
            rulerMarkers.push(marker);
            rulerPoints.push({ lat, lng });
            
            if (rulerPoints.length === 1) {
                document.getElementById('rulerHint').textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà 2 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞';
            } else if (rulerPoints.length === 2) {
                const dist = haversineDistance(
                    rulerPoints[0].lat, rulerPoints[0].lng,
                    rulerPoints[1].lat, rulerPoints[1].lng
                );
                document.getElementById('rulerDistance').textContent = dist.toFixed(2) + ' km';
                document.getElementById('rulerHint').textContent = '‡∏Ñ‡∏•‡∏¥‡∏Å‡∏à‡∏∏‡∏î‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà';
                
                rulerLine = new google.maps.Polyline({
                    path: rulerPoints,
                    geodesic: true,
                    strokeColor: '#667eea',
                    strokeOpacity: 1,
                    strokeWeight: 3,
                    map: map
                });
            } else {
                clearRuler();
                onRulerClick(e);
            }
        }
        
        function clearRuler() {
            rulerMarkers.forEach(m => m.setMap(null));
            rulerMarkers = [];
            rulerPoints = [];
            if (rulerLine) {
                rulerLine.setMap(null);
                rulerLine = null;
            }
        }
        
        // ===== ‡∏ã‡πà‡∏≠‡∏ô/‡πÅ‡∏™‡∏î‡∏á UI =====
        let uiHidden = false;
        
        function toggleUI() {
            const btn = document.querySelector('.hide-ui-btn');
            
            if (uiHidden) {
                document.body.classList.remove('ui-hidden');
                btn.classList.remove('active');
                btn.innerHTML = 'üëÅÔ∏è ‡∏ã‡πà‡∏≠‡∏ô UI';
            } else {
                document.body.classList.add('ui-hidden');
                btn.classList.add('active');
                btn.innerHTML = 'üëÅÔ∏è ‡πÅ‡∏™‡∏î‡∏á UI';
            }
            
            uiHidden = !uiHidden;
        }
        
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 17.5, lng: 104 },
                zoom: 6,
                styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }],
                mapTypeControl: true,
                fullscreenControl: true,
                streetViewControl: false
            });
            infoWindow = new google.maps.InfoWindow();
            loadData();
        }
        
        function getCellValue(row, index) {
            if (row.c && row.c[index] && row.c[index].v !== null && row.c[index].v !== undefined) {
                return row.c[index].v;
            }
            return '';
        }
        
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loadingText').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...';
            
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
                const response = await fetch(url);
                const text = await response.text();
                
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S\w]+)\)/);
                
                if (!match || !match[1]) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                }
                
                const json = JSON.parse(match[1]);
                
                locationsData = [];
                json.table.rows.forEach((row, idx) => {
                    const lat = parseFloat(getCellValue(row, 2));
                    const lng = parseFloat(getCellValue(row, 3));
                    
                    if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                        locationsData.push({
                            id: getCellValue(row, 0) || idx + 1,
                            name: getCellValue(row, 1) || '',
                            lat: lat,
                            lng: lng,
                            freq: getCellValue(row, 4) || 0,
                            province: getCellValue(row, 5) || '',
                            area: getCellValue(row, 6) || '',
                            team: getCellValue(row, 7) || '',
                            gmaps: getCellValue(row, 8) || '',
                            status: getCellValue(row, 9) || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à',
                            date: getCellValue(row, 10) || '',
                            // ‡πÇ‡∏ó‡∏£
                            ais_call: getCellValue(row, 13) || '',
                            dtac_call: getCellValue(row, 14) || '',
                            true_call: getCellValue(row, 15) || '',
                            // ‡πÄ‡∏ô‡πá‡∏ï
                            ais_net: getCellValue(row, 16) || '',
                            dtac_net: getCellValue(row, 17) || '',
                            true_net: getCellValue(row, 18) || '',
                            note: getCellValue(row, 21) || ''
                        });
                    }
                });
                
                console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', locationsData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                
                renderMarkers();
                updateStats();
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('loadingText').innerHTML = `
                    <div class="error-box">
                        <h3>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</h3>
                        <p>Error: ${error.message}</p>
                        <button onclick="loadData()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                `;
                return;
            }
            
            document.getElementById('loading').classList.add('hidden');
        }
        
        function getMarkerColor(loc) {
            if (loc.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß') {
                // ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏Ñ‡πà‡∏≤‡∏¢‡πÑ‡∏´‡∏ô‡πÇ‡∏ó‡∏£‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏ô‡πá‡∏ï‡πÑ‡∏î‡πâ = ‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß
                const hasSignal = 
                    loc.ais_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || loc.ais_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                    loc.dtac_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || loc.dtac_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                    loc.true_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || loc.true_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ';
                return hasSignal ? 'green' : 'orange';
            }
            return 'gray';
        }
        
        function getMarkerIcon(loc) {
            const color = getMarkerColor(loc);
            const colors = {
                green: '#11998e',
                orange: '#f5576c',
                gray: '#95a5a6'
            };
            const symbols = {
                green: '‚úì',
                orange: '‚úó',
                gray: '?'
            };
            
            return {
                path: google.maps.SymbolPath.CIRCLE,
                fillColor: colors[color],
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 3,
                scale: 14
            };
        }
        
        function createInfo(loc) {
            const gc = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? 'ok' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? 'no' : '');
            const gi = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? '‚úì' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? '‚úó' : '-');
            const color = getMarkerColor(loc);
            const statusText = {
                green: '‚úÖ ‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì - ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ',
                orange: '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì - ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢',
                gray: '‚è≥ ‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            };
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
            const nearest = findNearestBorderPoint(loc.lat, loc.lng);
            const distanceText = `${nearest.distance.toFixed(1)} km`;
            
            return `
                <div class="info-window">
                    <div class="info-header">
                        <div class="info-title">${loc.name}</div>
                        <div class="info-subtitle">#${loc.id} ‚Ä¢ ${loc.province || '-'}</div>
                    </div>
                    <div class="info-body">
                        <div class="info-row">
                            <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                            <span class="info-value">${statusText[color]}</span>
                        </div>
                        <div class="info-row" style="background:#fff3cd;margin:0 -20px;padding:8px 20px;">
                            <span class="info-label">üìè ‡∏´‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô</span>
                            <span class="info-value" style="color:#856404;">${distanceText}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏õ.</span>
                            <span class="info-value">${loc.area || '-'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•</span>
                            <span class="info-value">${loc.team || '-'}</span>
                        </div>
                        ${loc.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? `
                        <div style="margin-top:15px;">
                            <table style="width:100%;border-collapse:collapse;font-size:12px;">
                                <tr style="background:#f8f9fa;">
                                    <th style="padding:8px;text-align:left;">‡∏Ñ‡πà‡∏≤‡∏¢</th>
                                    <th style="padding:8px;text-align:center;">üìû ‡πÇ‡∏ó‡∏£</th>
                                    <th style="padding:8px;text-align:center;">üåê ‡πÄ‡∏ô‡πá‡∏ï</th>
                                </tr>
                                <tr>
                                    <td style="padding:8px;font-weight:600;color:#00a651;">AIS</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.ais_call)}">${gi(loc.ais_call)}</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.ais_net)}">${gi(loc.ais_net)}</td>
                                </tr>
                                <tr style="background:#f8f9fa;">
                                    <td style="padding:8px;font-weight:600;color:#00b2e3;">DTAC</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.dtac_call)}">${gi(loc.dtac_call)}</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.dtac_net)}">${gi(loc.dtac_net)}</td>
                                </tr>
                                <tr>
                                    <td style="padding:8px;font-weight:600;color:#eb2227;">TRUE</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.true_call)}">${gi(loc.true_call)}</td>
                                    <td style="padding:8px;text-align:center;" class="${gc(loc.true_net)}">${gi(loc.true_net)}</td>
                                </tr>
                            </table>
                        </div>
                        ` : ''}
                        ${loc.note ? `<p style="margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;font-size:12px;color:#666;">üìù ${loc.note}</p>` : ''}
                        ${loc.gmaps ? `<a href="${loc.gmaps}" target="_blank" class="btn-maps">üìç ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</a>` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderMarkers() {
            markers.forEach(m => {
                m.marker.setMap(null);
                if (m.label) m.label.setMap(null);
            });
            markers = [];
            
            const bounds = new google.maps.LatLngBounds();
            
            locationsData.forEach(loc => {
                const position = { lat: loc.lat, lng: loc.lng };
                bounds.extend(position);
                
                const color = getMarkerColor(loc);
                const symbols = { green: '‚úì', orange: '‚úó', gray: '?' };
                
                // Main marker
                const marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: getMarkerIcon(loc),
                    title: loc.name,
                    label: {
                        text: symbols[color],
                        color: 'white',
                        fontSize: '14px',
                        fontWeight: 'bold'
                    }
                });
                
                // Label with ID
                const idCode = (loc.name.match(/^[AL]\d+/) || [loc.id])[0];
                
                const labelMarker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: {
                        url: 'data:image/svg+xml,' + encodeURIComponent(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"></svg>
                        `),
                        anchor: new google.maps.Point(0, -20)
                    },
                    label: {
                        text: idCode,
                        color: color === 'green' ? '#11998e' : (color === 'orange' ? '#f5576c' : '#95a5a6'),
                        fontSize: '12px',
                        fontWeight: '700',
                        fontFamily: 'Prompt, sans-serif'
                    }
                });
                
                marker.addListener('click', () => {
                    infoWindow.setContent(createInfo(loc));
                    infoWindow.open(map, marker);
                });
                
                markers.push({ marker, label: labelMarker });
            });
            
            if (markers.length > 0) {
                map.fitBounds(bounds);
            }
        }
        
        function updateStats() {
            const total = locationsData.length;
            const surveyedOk = locationsData.filter(l => {
                if (l.status !== '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß') return false;
                return l.ais_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.ais_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                       l.dtac_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.dtac_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                       l.true_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.true_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ';
            }).length;
            const surveyedNo = locationsData.filter(l => {
                if (l.status !== '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß') return false;
                return !(l.ais_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.ais_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                         l.dtac_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.dtac_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ||
                         l.true_call === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' || l.true_net === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ');
            }).length;
            const pending = locationsData.filter(l => l.status !== '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß').length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('surveyedOkCount').textContent = surveyedOk;
            document.getElementById('surveyedNoCount').textContent = surveyedNo;
            document.getElementById('pendingCount').textContent = pending;
        }
        
        window.initMap = initMap;
    </script>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtMkrEmWVIp6IW6vkZ9A-7vjQKc8njTOA&callback=initMap"></script>
</body>
</html>
