<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏™‡πÅ‡∏Å‡∏°‡πÄ‡∏°‡∏≠‡∏£‡πå‡∏•‡∏≤‡∏ß</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Prompt', sans-serif; }
        #map { height: 100vh; width: 100%; }
        
        /* Header Stats */
        .header-stats { position: absolute; top: 20px; left: 50%; transform: translateX(-50%); z-index: 1000; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 30px; border-radius: 20px; box-shadow: 0 10px 40px rgba(0,0,0,0.3); display: flex; gap: 25px; align-items: center; }
        .stat-box { text-align: center; padding: 0 15px; }
        .stat-box:not(:last-child) { border-right: 1px solid rgba(255,255,255,0.2); }
        .stat-number { font-size: 32px; font-weight: 700; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .stat-number.green { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); -webkit-background-clip: text; }
        .stat-number.orange { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); -webkit-background-clip: text; }
        .stat-number.gray { background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%); -webkit-background-clip: text; }
        .stat-label { font-size: 11px; color: rgba(255,255,255,0.7); margin-top: 3px; }
        
        /* Legend - Redesigned */
        .legend {
            position: absolute;
            bottom: 30px;
            left: 20px;
            z-index: 1000;
            background: white;
            padding: 20px;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            min-width: 280px;
        }
        .legend h4 {
            font-size: 16px;
            font-weight: 600;
            color: #1a1a2e;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .legend-section {
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }
        .legend-section:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }
        .legend-section-title {
            font-size: 12px;
            color: #888;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin: 8px 0;
            font-size: 13px;
            color: #333;
        }
        .legend-marker {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            color: white;
            font-weight: 700;
            border: 3px solid white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }
        .legend-marker.green { background: #11998e; }
        .legend-marker.orange { background: #f5576c; }
        .legend-marker.gray { background: #95a5a6; }
        .legend-text {
            flex: 1;
        }
        .legend-text strong {
            display: block;
            font-weight: 600;
            margin-bottom: 2px;
        }
        .legend-text span {
            font-size: 11px;
            color: #888;
        }
        
        /* Signal Legend */
        .signal-box {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin-top: 10px;
        }
        .signal-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 0;
            font-size: 12px;
        }
        .signal-provider {
            font-weight: 600;
            width: 50px;
        }
        .signal-icons {
            display: flex;
            gap: 15px;
        }
        .signal-icons span {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .sig-ok { color: #11998e; }
        .sig-no { color: #f5576c; }
        
        /* Buttons */
        .refresh-btn { position: absolute; top: 20px; right: 20px; z-index: 1000; background: white; border: none; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); cursor: pointer; font-family: 'Prompt', sans-serif; font-size: 14px; transition: all 0.3s; }
        .refresh-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(0,0,0,0.15); }
        
        .distance-btn { 
            position: absolute; 
            top: 20px; 
            right: 140px; 
            z-index: 1000; 
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); 
            color: white;
            border: none; 
            padding: 12px 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(17,153,142,0.4); 
            cursor: pointer; 
            font-family: 'Prompt', sans-serif; 
            font-size: 14px; 
            transition: all 0.3s; 
        }
        .distance-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(17,153,142,0.5); }
        .distance-btn.active { background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); box-shadow: 0 4px 15px rgba(235,51,73,0.4); }
        .edit-btn { position: absolute; top: 20px; left: 20px; z-index: 1000; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 12px 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(102,126,234,0.4); font-family: 'Prompt', sans-serif; font-size: 14px; text-decoration: none; transition: all 0.3s; }
        .edit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 25px rgba(102,126,234,0.5); }
        
        /* Info Window */
        .info-window { min-width: 300px; font-family: 'Prompt', sans-serif; }
        .info-header { background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); padding: 15px 20px; color: white; border-radius: 12px 12px 0 0; }
        .info-title { font-size: 16px; font-weight: 600; margin-bottom: 5px; }
        .info-subtitle { font-size: 12px; opacity: 0.7; }
        .info-body { padding: 15px 20px; }
        .info-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .info-label { color: #888; }
        .info-value { font-weight: 500; color: #333; }
        .signal-grid { display: flex; gap: 8px; margin-top: 15px; }
        .signal-card { flex: 1; text-align: center; padding: 12px 8px; border-radius: 12px; background: #f8f9fa; }
        .signal-card.ok { background: #d4edda; }
        .signal-card.no { background: #f8d7da; }
        .signal-card-provider { font-size: 12px; font-weight: 600; margin-bottom: 5px; }
        .signal-status { font-size: 18px; }
        .btn-maps { display: block; text-align: center; padding: 12px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; text-decoration: none; border-radius: 10px; margin-top: 15px; font-size: 13px; }
        
        /* Loading */
        .loading { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); display: flex; justify-content: center; align-items: center; z-index: 9999; flex-direction: column; gap: 20px; }
        .loading.hidden { display: none; }
        .loading-spinner { width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.1); border-top: 4px solid #667eea; border-radius: 50%; animation: spin 1s linear infinite; }
        .loading-text { color: rgba(255,255,255,0.7); font-size: 14px; }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .error-box { background: #fff; padding: 30px; border-radius: 16px; text-align: center; max-width: 400px; }
        .error-box h3 { color: #eb3349; margin-bottom: 10px; }
        .error-box p { color: #666; font-size: 14px; margin-bottom: 20px; }
        .error-box button { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 10px; font-family: 'Prompt', sans-serif; font-size: 14px; cursor: pointer; }
        
        /* Custom Marker Label */
        .marker-label {
            background: white;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 6px rgba(0,0,0,0.2);
            white-space: nowrap;
            border: 2px solid;
        }
        .marker-label.green { border-color: #11998e; color: #11998e; }
        .marker-label.orange { border-color: #f5576c; color: #f5576c; }
        .marker-label.gray { border-color: #95a5a6; color: #95a5a6; }
        
        .legend h4 small { display: none; }
        
        @media (max-width: 768px) { 
            /* Header Stats ‡πÄ‡∏•‡πá‡∏Å‡∏•‡∏á */
            .header-stats { 
                padding: 8px 10px; 
                gap: 8px; 
                width: 95%; 
                top: 10px;
                border-radius: 12px;
            } 
            .stat-box { padding: 0 8px; }
            .stat-number { font-size: 18px; } 
            .stat-label { font-size: 9px; line-height: 1.2; }
            
            /* Legend ‡πÄ‡∏•‡πá‡∏Å‡∏Å‡∏∞‡∏ó‡∏±‡∏î‡∏£‡∏±‡∏î ‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà */
            .legend {
                bottom: 20px;
                left: 10px;
                right: auto;
                top: auto;
                width: auto;
                max-width: 200px;
                max-height: 45px;
                overflow: hidden;
                transition: max-height 0.3s ease-out;
                min-width: 0;
                padding: 10px 12px;
                cursor: pointer;
            }
            .legend.active {
                max-height: 350px;
                max-width: 280px;
                overflow-y: auto;
            }
            .legend.active h4::after {
                content: ' ‚ñ¥';
            }
            .legend h4 { font-size: 13px; margin-bottom: 0; }
            .legend.active h4 { margin-bottom: 12px; }
            .legend h4 small { display: inline; }
            .legend h4::after {
                content: ' ‚ñæ';
            }
            .legend-section { margin-bottom: 8px; padding-bottom: 8px; }
            .legend-section-title { font-size: 10px; margin-bottom: 6px; }
            .legend-item { margin: 5px 0; }
            .legend-marker { width: 22px; height: 22px; font-size: 10px; margin-right: 8px; border-width: 2px; }
            .legend-text strong { font-size: 11px; }
            .legend-text span { font-size: 9px; }
            .signal-box { padding: 6px; margin-top: 6px; }
            .signal-row { font-size: 10px; padding: 3px 0; }
            .signal-provider { width: 40px; }
            
            /* ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏á‡∏Å‡∏•‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
            .edit-btn { 
                left: auto;
                right: 70px; 
                bottom: 25px; 
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .edit-btn span { display: none; }
            .refresh-btn { 
                right: 15px; 
                bottom: 25px; 
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .refresh-btn span { display: none; }
            
            /* ‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞ */
            .distance-btn {
                right: 125px;
                bottom: 25px;
                top: auto;
                width: 45px;
                height: 45px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 18px;
                padding: 0;
            }
            .distance-btn span { display: none; }
        }
    </style>
</head>
<body>
    <div id="loading" class="loading">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...</div>
    </div>
    
    <div id="map"></div>
    
    <div class="header-stats">
        <div class="stat-box">
            <div class="stat-number" id="totalCount">0</div>
            <div class="stat-label">‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
        </div>
        <div class="stat-box">
            <div class="stat-number green" id="surveyedOkCount">0</div>
            <div class="stat-label">‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì<br>‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ</div>
        </div>
        <div class="stat-box">
            <div class="stat-number orange" id="surveyedNoCount">0</div>
            <div class="stat-label">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì<br>‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢</div>
        </div>
        <div class="stat-box">
            <div class="stat-number gray" id="pendingCount">0</div>
            <div class="stat-label">‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à</div>
        </div>
    </div>
    
    <a href="https://docs.google.com/spreadsheets/d/1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg/edit" target="_blank" class="edit-btn">üìù<span> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</span></a>
    
    <button class="refresh-btn" onclick="loadData()">üîÑ<span> ‡∏£‡∏µ‡πÄ‡∏ü‡∏£‡∏ä</span></button>
    
    <button class="distance-btn" onclick="toggleDistanceLines()">üìè<span> ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞</span></button>
    
    <div class="legend" onclick="this.classList.toggle('active')">
        <h4>üìç ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà <small style="font-weight:normal;font-size:11px;opacity:0.6;">(‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π)</small></h4>
        
        <div class="legend-section">
            <div class="legend-section-title">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏´‡∏°‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏™‡∏µ</div>
            
            <div class="legend-item">
                <div class="legend-marker green">‚úì</div>
                <div class="legend-text">
                    <strong>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</strong>
                    <span>‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ</span>
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-marker orange">‚úó</div>
                <div class="legend-text">
                    <strong>‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß - ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</strong>
                    <span>‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÉ‡∏ô‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ</span>
                </div>
            </div>
            
            <div class="legend-item">
                <div class="legend-marker gray">?</div>
                <div class="legend-text">
                    <strong>‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à</strong>
                    <span>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì</span>
                </div>
            </div>
        </div>
        
        <div class="legend-section">
            <div class="legend-section-title">‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì (‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ó‡∏µ‡πà‡∏à‡∏∏‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π)</div>
            <div class="signal-box">
                <div class="signal-row">
                    <span class="signal-provider" style="color:#00a651;">AIS</span>
                    <div class="signal-icons">
                        <span class="sig-ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>
                        <span class="sig-no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
                    </div>
                </div>
                <div class="signal-row">
                    <span class="signal-provider" style="color:#00b2e3;">DTAC</span>
                    <div class="signal-icons">
                        <span class="sig-ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>
                        <span class="sig-no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
                    </div>
                </div>
                <div class="signal-row">
                    <span class="signal-provider" style="color:#eb2227;">TRUE</span>
                    <div class="signal-icons">
                        <span class="sig-ok">‚úì ‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ</span>
                        <span class="sig-no">‚úó ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1oWbmuEa2Fhn2u03q7X_jFGpXdm1HrtOoHe7WYL8eDfg';
        let map, markers = [], infoWindow, locationsData = [];
        let distanceLines = [], distanceLabels = [];
        let showingDistances = false;
        
        // ‡∏û‡∏¥‡∏Å‡∏±‡∏î‡∏ù‡∏±‡πà‡∏á‡πÑ‡∏ó‡∏¢ (‡∏Ç‡∏≠‡∏ö‡πÅ‡∏ú‡πà‡∏ô‡∏î‡∏¥‡∏ô‡πÑ‡∏ó‡∏¢‡∏£‡∏¥‡∏°‡πÅ‡∏°‡πà‡∏ô‡πâ‡∏≥‡πÇ‡∏Ç‡∏á) - ‡∏à‡∏≤‡∏Å‡πÄ‡∏´‡∏ô‡∏∑‡∏≠‡∏•‡∏á‡πÉ‡∏ï‡πâ
const THAI_BORDER = [
            { lat: 20.445006, lng: 99.937135 },
            { lat: 20.427488, lng: 99.958787 },
            { lat: 20.400823, lng: 99.974342 },
            { lat: 20.383589, lng: 100.008448 },
            { lat: 20.364779, lng: 100.042658 },
            { lat: 20.317805, lng: 100.099295 },
            { lat: 20.248016, lng: 100.116607 },
            { lat: 20.253623, lng: 100.167715 },
            { lat: 20.302483, lng: 100.179497 },
            { lat: 20.312999, lng: 100.209159 },
            { lat: 20.391831, lng: 100.270241 },
            { lat: 20.368965, lng: 100.364395 },
            { lat: 20.210240, lng: 100.452142 },
            { lat: 20.185720, lng: 100.468782 },
            { lat: 20.164868, lng: 100.496377 },
            { lat: 20.153474, lng: 100.536685 },
            { lat: 20.158021, lng: 100.548674 },
            { lat: 19.995499, lng: 100.518546 },
            { lat: 19.880700, lng: 100.483975 },
            { lat: 19.852123, lng: 100.446251 },
            { lat: 19.810446, lng: 100.420516 },
            { lat: 19.745669, lng: 100.379175 },
            { lat: 19.711640, lng: 100.400466 },
            { lat: 19.651566, lng: 100.412920 },
            { lat: 19.597771, lng: 100.447491 },
            { lat: 19.551831, lng: 100.458963 },
            { lat: 19.514469, lng: 100.491829 },
            { lat: 19.495633, lng: 100.566657 },
            { lat: 19.540927, lng: 100.607016 },
            { lat: 19.504650, lng: 100.729231 },
            { lat: 19.482429, lng: 100.753002 },
            { lat: 19.582527, lng: 100.849017 },
            { lat: 19.612912, lng: 100.874597 },
            { lat: 19.613481, lng: 100.974281 },
            { lat: 19.577126, lng: 101.068228 },
            { lat: 19.568367, lng: 101.152668 },
            { lat: 19.586867, lng: 101.197316 },
            { lat: 19.578186, lng: 101.238244 },
            { lat: 19.547154, lng: 101.254884 },
            { lat: 19.472301, lng: 101.238244 },
            { lat: 19.417214, lng: 101.177782 },
            { lat: 19.341999, lng: 101.185017 },
            { lat: 19.326367, lng: 101.211269 },
            { lat: 19.309417, lng: 101.209512 },
            { lat: 19.143587, lng: 101.229149 },
            { lat: 19.078992, lng: 101.291161 },
            { lat: 18.981478, lng: 101.283926 },
            { lat: 18.919492, lng: 101.257261 },
            { lat: 18.855491, lng: 101.223309 },
            { lat: 18.746325, lng: 101.209202 },
            { lat: 18.689481, lng: 101.234782 },
            { lat: 18.642041, lng: 101.221914 },
            { lat: 18.606359, lng: 101.167757 },
            { lat: 18.567705, lng: 101.159127 },
            { lat: 18.510422, lng: 101.077892 },
            { lat: 18.476419, lng: 101.064714 },
            { lat: 18.410453, lng: 101.037016 },
            { lat: 18.364203, lng: 101.082284 },
            { lat: 18.316377, lng: 101.152409 },
            { lat: 18.280952, lng: 101.127966 },
            { lat: 18.218708, lng: 101.139645 },
            { lat: 18.204058, lng: 101.159282 },
            { lat: 18.141943, lng: 101.145640 },
            { lat: 18.067451, lng: 101.162073 },
            { lat: 18.021330, lng: 101.125434 },
            { lat: 17.958336, lng: 101.081974 },
            { lat: 17.895240, lng: 101.008284 },
            { lat: 17.830489, lng: 101.000274 },
            { lat: 17.803824, lng: 100.967046 },
            { lat: 17.783980, lng: 100.974281 },
            { lat: 17.777624, lng: 100.975211 },
            { lat: 17.764136, lng: 100.958571 },
            { lat: 17.725586, lng: 100.960690 },
            { lat: 17.654531, lng: 100.932940 },
            { lat: 17.573761, lng: 100.886017 },
            { lat: 17.547612, lng: 100.981515 },
            { lat: 17.512627, lng: 101.035466 },
            { lat: 17.475265, lng: 101.096030 },
            { lat: 17.461674, lng: 101.132307 },
            { lat: 17.495781, lng: 101.164243 },
            { lat: 17.518725, lng: 101.190288 },
            { lat: 17.568490, lng: 101.228632 },
            { lat: 17.683160, lng: 101.369864 },
            { lat: 17.706672, lng: 101.401593 },
            { lat: 17.717163, lng: 101.398751 },
            { lat: 17.729307, lng: 101.388002 },
            { lat: 17.733596, lng: 101.432030 },
            { lat: 17.751011, lng: 101.453476 },
            { lat: 17.739487, lng: 101.459109 },
            { lat: 17.730598, lng: 101.474198 },
            { lat: 17.765377, lng: 101.502724 },
            { lat: 17.809560, lng: 101.534040 },
            { lat: 17.828887, lng: 101.570523 },
            { lat: 17.868109, lng: 101.577551 },
            { lat: 17.884646, lng: 101.619874 },
            { lat: 17.932033, lng: 101.732581 },
            { lat: 18.058563, lng: 101.773922 },
            { lat: 18.062387, lng: 101.806064 },
            { lat: 18.037117, lng: 101.904301 },
            { lat: 18.213799, lng: 102.078503 },
            { lat: 18.200286, lng: 102.171934 },
            { lat: 18.152071, lng: 102.191571 },
            { lat: 18.124166, lng: 102.233119 },
            { lat: 18.037040, lng: 102.336523 },
            { lat: 17.994200, lng: 102.412229 },
            { lat: 17.970842, lng: 102.567517 },
            { lat: 17.850074, lng: 102.595577 },
            { lat: 17.812867, lng: 102.660793 },
            { lat: 17.831781, lng: 102.673350 },
            { lat: 17.873535, lng: 102.686734 },
            { lat: 17.922731, lng: 102.774067 },
            { lat: 17.972031, lng: 102.852719 },
            { lat: 18.007739, lng: 102.972918 },
            { lat: 17.990686, lng: 103.037927 },
            { lat: 18.025774, lng: 103.068210 },
            { lat: 18.112255, lng: 103.066349 },
            { lat: 18.138667, lng: 103.087703 },
            { lat: 18.136853, lng: 103.090586 },
            { lat: 18.134786, lng: 103.089087 },
            { lat: 18.166722, lng: 103.138593 },
            { lat: 18.237028, lng: 103.157300 },
            { lat: 18.257750, lng: 103.185205 },
            { lat: 18.276069, lng: 103.273520 },
            { lat: 18.296895, lng: 103.296516 },
            { lat: 18.335988, lng: 103.240189 },
            { lat: 18.349269, lng: 103.233678 },
            { lat: 18.400196, lng: 103.260756 },
            { lat: 18.441459, lng: 103.386640 },
            { lat: 18.421978, lng: 103.469942 },
            { lat: 18.423734, lng: 103.497744 },
            { lat: 18.400403, lng: 103.607143 },
            { lat: 18.377949, lng: 103.638614 },
            { lat: 18.346685, lng: 103.767185 },
            { lat: 18.330355, lng: 103.817260 },
            { lat: 18.296352, lng: 103.848989 },
            { lat: 18.284415, lng: 103.881287 },
            { lat: 18.297256, lng: 103.893689 },
            { lat: 18.332991, lng: 103.951257 },
            { lat: 18.299117, lng: 104.018643 },
            { lat: 18.095279, lng: 104.122357 },
            { lat: 18.018644, lng: 104.203329 },
            { lat: 17.884646, lng: 104.264312 },
            { lat: 17.861488, lng: 104.281982 },
            { lat: 17.800568, lng: 104.367769 },
            { lat: 17.733699, lng: 104.408903 },
            { lat: 17.699799, lng: 104.422287 },
            { lat: 17.562443, lng: 104.636383 },
            { lat: 17.515263, lng: 104.714517 },
            { lat: 17.449944, lng: 104.756789 },
            { lat: 17.428963, lng: 104.788932 },
            { lat: 17.361060, lng: 104.819317 },
            { lat: 17.240241, lng: 104.818335 },
            { lat: 17.024802, lng: 104.745317 },
            { lat: 16.910803, lng: 104.749657 },
            { lat: 16.868170, lng: 104.766401 },
            { lat: 16.821920, lng: 104.758442 },
            { lat: 16.798459, lng: 104.756789 },
            { lat: 16.694021, lng: 104.777563 },
            { lat: 16.571909, lng: 104.748417 },
            { lat: 16.511345, lng: 104.765160 },
            { lat: 16.454087, lng: 104.855491 },
            { lat: 16.403909, lng: 104.887737 },
            { lat: 16.353370, lng: 104.908046 },
            { lat: 16.324431, lng: 104.952074 },
            { lat: 16.293963, lng: 104.988028 },
            { lat: 16.257665, lng: 105.026385 },
            { lat: 16.165268, lng: 105.032586 },
            { lat: 16.105426, lng: 105.079301 },
            { lat: 16.049151, lng: 105.247405 },
            { lat: 16.015199, lng: 105.414475 },
            { lat: 16.002125, lng: 105.423932 },
            { lat: 15.980783, lng: 105.386518 },
            { lat: 15.882132, lng: 105.372565 },
            { lat: 15.771648, lng: 105.435662 },
            { lat: 15.766171, lng: 105.503410 },
            { lat: 15.721470, lng: 105.612912 },
            { lat: 15.583313, lng: 105.640869 },
            { lat: 15.457171, lng: 105.610380 },
            { lat: 15.423788, lng: 105.588366 },
            { lat: 15.374902, lng: 105.486253 },
            { lat: 15.324673, lng: 105.499017 },
            { lat: 15.325138, lng: 105.558032 },
            { lat: 15.272531, lng: 105.563975 },
            { lat: 15.231061, lng: 105.503927 },
            { lat: 15.155303, lng: 105.447703 },
            { lat: 15.094765, lng: 105.451940 },
            { lat: 15.064896, lng: 105.503565 },
            { lat: 15.061175, lng: 105.523150 },
            { lat: 15.005338, lng: 105.553536 },
            { lat: 14.995933, lng: 105.566455 },
            { lat: 14.953094, lng: 105.543924 },
            { lat: 14.880101, lng: 105.543046 },
            { lat: 14.877672, lng: 105.517776 },
            { lat: 14.842532, lng: 105.524080 },
            { lat: 14.830414, lng: 105.506200 },
            { lat: 14.786334, lng: 105.489147 },
            { lat: 14.736363, lng: 105.505115 },
            { lat: 14.593581, lng: 105.510128 },
        ];
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á Haversine
        function haversineDistance(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }
        
        // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô‡πÄ‡∏™‡πâ‡∏ô (line segment)
        function nearestPointOnSegment(px, py, ax, ay, bx, by) {
            const dx = bx - ax;
            const dy = by - ay;
            if (dx === 0 && dy === 0) {
                return { lat: ay, lng: ax };
            }
            const t = Math.max(0, Math.min(1, ((px - ax) * dx + (py - ay) * dy) / (dx * dx + dy * dy)));
            return {
                lat: ay + t * dy,
                lng: ax + t * dx
            };
        }
        
        // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ö‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÑ‡∏ó‡∏¢‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
        function findNearestBorderPoint(lat, lng) {
            let nearestPoint = null;
            let minDistance = Infinity;
            
            // ‡∏ß‡∏ô‡∏•‡∏π‡∏õ‡∏ó‡∏∏‡∏Å segment ‡∏Ç‡∏≠‡∏á‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
            for (let i = 0; i < THAI_BORDER.length - 1; i++) {
                const a = THAI_BORDER[i];
                const b = THAI_BORDER[i + 1];
                
                // ‡∏´‡∏≤‡∏à‡∏∏‡∏î‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏ö‡∏ô segment ‡∏ô‡∏µ‡πâ
                const nearest = nearestPointOnSegment(lng, lat, a.lng, a.lat, b.lng, b.lat);
                const dist = haversineDistance(lat, lng, nearest.lat, nearest.lng);
                
                if (dist < minDistance) {
                    minDistance = dist;
                    nearestPoint = nearest;
                }
            }
            
            return { point: nearestPoint, distance: minDistance };
        }
        
        // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
        function toggleDistanceLines() {
            const btn = document.querySelector('.distance-btn');
            
            if (showingDistances) {
                clearDistanceLines();
                btn.classList.remove('active');
                btn.innerHTML = 'üìè<span> ‡∏ß‡∏±‡∏î‡∏£‡∏∞‡∏¢‡∏∞</span>';
            } else {
                drawDistanceLines();
                btn.classList.add('active');
                btn.innerHTML = '‚ùå<span> ‡∏õ‡∏¥‡∏î‡∏£‡∏∞‡∏¢‡∏∞</span>';
            }
            
            showingDistances = !showingDistances;
        }
        
        // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
        function drawDistanceLines() {
            clearDistanceLines();
            
            locationsData.forEach(loc => {
                const nearest = findNearestBorderPoint(loc.lat, loc.lng);
                
                // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô
                const line = new google.maps.Polyline({
                    path: [
                        { lat: loc.lat, lng: loc.lng },
                        { lat: nearest.point.lat, lng: nearest.point.lng }
                    ],
                    geodesic: true,
                    strokeColor: '#e74c3c',
                    strokeOpacity: 0.8,
                    strokeWeight: 2,
                    map: map
                });
                distanceLines.push(line);
                
                // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏à‡∏∏‡∏î‡∏Å‡∏•‡∏≤‡∏á‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö label
                const midLat = (loc.lat + nearest.point.lat) / 2;
                const midLng = (loc.lng + nearest.point.lng) / 2;
                
                // ‡∏™‡∏£‡πâ‡∏≤‡∏á label ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
                const labelMarker = new google.maps.Marker({
                    position: { lat: midLat, lng: midLng },
                    map: map,
                    icon: {
                        url: 'data:image/svg+xml,' + encodeURIComponent(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"></svg>
                        `),
                    },
                    label: {
                        text: `${nearest.distance.toFixed(1)} km`,
                        color: '#c0392b',
                        fontSize: '11px',
                        fontWeight: 'bold',
                        fontFamily: 'Prompt, sans-serif'
                    }
                });
                distanceLabels.push(labelMarker);
            });
            
            // ‡∏ß‡∏≤‡∏î‡πÄ‡∏™‡πâ‡∏ô‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô‡πÑ‡∏ó‡∏¢
            const borderLine = new google.maps.Polyline({
                path: THAI_BORDER,
                geodesic: true,
                strokeColor: '#3498db',
                strokeOpacity: 0.8,
                strokeWeight: 3,
                map: map
            });
            distanceLines.push(borderLine);
        }
        
        // ‡∏•‡∏ö‡πÄ‡∏™‡πâ‡∏ô‡∏£‡∏∞‡∏¢‡∏∞‡∏ó‡∏≤‡∏á
        function clearDistanceLines() {
            distanceLines.forEach(line => line.setMap(null));
            distanceLabels.forEach(label => label.setMap(null));
            distanceLines = [];
            distanceLabels = [];
        }
        
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 17.5, lng: 104 },
                zoom: 6,
                styles: [{ featureType: "poi", elementType: "labels", stylers: [{ visibility: "off" }] }],
                mapTypeControl: true,
                fullscreenControl: true,
                streetViewControl: false
            });
            infoWindow = new google.maps.InfoWindow();
            loadData();
        }
        
        function getCellValue(row, index) {
            if (row.c && row.c[index] && row.c[index].v !== null && row.c[index].v !== undefined) {
                return row.c[index].v;
            }
            return '';
        }
        
        async function loadData() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('loadingText').textContent = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet...';
            
            try {
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
                const response = await fetch(url);
                const text = await response.text();
                
                const match = text.match(/google\.visualization\.Query\.setResponse\(([\s\S\w]+)\)/);
                
                if (!match || !match[1]) {
                    throw new Error("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á");
                }
                
                const json = JSON.parse(match[1]);
                
                locationsData = [];
                json.table.rows.forEach((row, idx) => {
                    const lat = parseFloat(getCellValue(row, 2));
                    const lng = parseFloat(getCellValue(row, 3));
                    
                    if (lat && lng && !isNaN(lat) && !isNaN(lng)) {
                        locationsData.push({
                            id: getCellValue(row, 0) || idx + 1,
                            name: getCellValue(row, 1) || '',
                            lat: lat,
                            lng: lng,
                            freq: getCellValue(row, 4) || 0,
                            province: getCellValue(row, 5) || '',
                            area: getCellValue(row, 6) || '',
                            team: getCellValue(row, 7) || '',
                            gmaps: getCellValue(row, 8) || '',
                            status: getCellValue(row, 9) || '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏™‡∏≥‡∏£‡∏ß‡∏à',
                            date: getCellValue(row, 10) || '',
                            ais: getCellValue(row, 13) || '',
                            dtac: getCellValue(row, 14) || '',
                            true_h: getCellValue(row, 15) || '',
                            note: getCellValue(row, 18) || ''
                        });
                    }
                });
                
                console.log('‚úÖ ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:', locationsData.length, '‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£');
                
                renderMarkers();
                updateStats();
                
            } catch (error) {
                console.error('‚ùå Error:', error);
                document.getElementById('loadingText').innerHTML = `
                    <div class="error-box">
                        <h3>‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏î‡πâ</h3>
                        <p>Error: ${error.message}</p>
                        <button onclick="loadData()">‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    </div>
                `;
                return;
            }
            
            document.getElementById('loading').classList.add('hidden');
        }
        
        function getMarkerColor(loc) {
            if (loc.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß') {
                return loc.ais === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? 'green' : 'orange';
            }
            return 'gray';
        }
        
        function getMarkerIcon(loc) {
            const color = getMarkerColor(loc);
            const colors = {
                green: '#11998e',
                orange: '#f5576c',
                gray: '#95a5a6'
            };
            const symbols = {
                green: '‚úì',
                orange: '‚úó',
                gray: '?'
            };
            
            return {
                path: google.maps.SymbolPath.CIRCLE,
                fillColor: colors[color],
                fillOpacity: 1,
                strokeColor: '#fff',
                strokeWeight: 3,
                scale: 14
            };
        }
        
        function createInfo(loc) {
            const gc = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? 'ok' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? 'no' : '');
            const gi = v => v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ' ? '‚úì' : (v === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ' ? '‚úó' : '-');
            const color = getMarkerColor(loc);
            const statusText = {
                green: '‚úÖ ‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì - ‡πÉ‡∏ä‡πâ‡∏°‡∏∑‡∏≠‡∏ñ‡∏∑‡∏≠‡πÑ‡∏î‡πâ',
                orange: '‚ùå ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì - ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å‡∏Ñ‡πà‡∏≤‡∏¢',
                gray: '‚è≥ ‡∏£‡∏≠‡∏™‡∏≥‡∏£‡∏ß‡∏à - ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•'
            };
            
            // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏à‡∏≤‡∏Å‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô
            const nearest = findNearestBorderPoint(loc.lat, loc.lng);
            const distanceText = `${nearest.distance.toFixed(1)} km`;
            
            return `
                <div class="info-window">
                    <div class="info-header">
                        <div class="info-title">${loc.name}</div>
                        <div class="info-subtitle">#${loc.id} ‚Ä¢ ${loc.province || '-'}</div>
                    </div>
                    <div class="info-body">
                        <div class="info-row">
                            <span class="info-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</span>
                            <span class="info-value">${statusText[color]}</span>
                        </div>
                        <div class="info-row" style="background:#fff3cd;margin:0 -20px;padding:8px 20px;">
                            <span class="info-label">üìè ‡∏´‡πà‡∏≤‡∏á‡∏ä‡∏≤‡∏¢‡πÅ‡∏î‡∏ô</span>
                            <span class="info-value" style="color:#856404;">${distanceText}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà ‡∏ä‡∏õ.</span>
                            <span class="info-value">${loc.area || '-'}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏•</span>
                            <span class="info-value">${loc.team || '-'}</span>
                        </div>
                        ${loc.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß' ? `
                        <div class="signal-grid">
                            <div class="signal-card ${gc(loc.ais)}">
                                <div class="signal-card-provider" style="color:#00a651;">AIS</div>
                                <div class="signal-status">${gi(loc.ais)}</div>
                            </div>
                            <div class="signal-card ${gc(loc.dtac)}">
                                <div class="signal-card-provider" style="color:#00b2e3;">DTAC</div>
                                <div class="signal-status">${gi(loc.dtac)}</div>
                            </div>
                            <div class="signal-card ${gc(loc.true_h)}">
                                <div class="signal-card-provider" style="color:#eb2227;">TRUE</div>
                                <div class="signal-status">${gi(loc.true_h)}</div>
                            </div>
                        </div>
                        ` : ''}
                        ${loc.note ? `<p style="margin-top:15px;padding:10px;background:#f8f9fa;border-radius:8px;font-size:12px;color:#666;">üìù ${loc.note}</p>` : ''}
                        ${loc.gmaps ? `<a href="${loc.gmaps}" target="_blank" class="btn-maps">üìç ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ô Google Maps</a>` : ''}
                    </div>
                </div>
            `;
        }
        
        function renderMarkers() {
            markers.forEach(m => {
                m.marker.setMap(null);
                if (m.label) m.label.setMap(null);
            });
            markers = [];
            
            const bounds = new google.maps.LatLngBounds();
            
            locationsData.forEach(loc => {
                const position = { lat: loc.lat, lng: loc.lng };
                bounds.extend(position);
                
                const color = getMarkerColor(loc);
                const symbols = { green: '‚úì', orange: '‚úó', gray: '?' };
                
                // Main marker
                const marker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: getMarkerIcon(loc),
                    title: loc.name,
                    label: {
                        text: symbols[color],
                        color: 'white',
                        fontSize: '14px',
                        fontWeight: 'bold'
                    }
                });
                
                // Label with name
                const labelDiv = document.createElement('div');
                const shortName = loc.name.split(' - ')[0] || loc.name.substring(0, 10);
                
                const labelMarker = new google.maps.Marker({
                    position: position,
                    map: map,
                    icon: {
                        url: 'data:image/svg+xml,' + encodeURIComponent(`
                            <svg xmlns="http://www.w3.org/2000/svg" width="1" height="1"></svg>
                        `),
                        anchor: new google.maps.Point(0, -20)
                    },
                    label: {
                        text: shortName,
                        color: color === 'green' ? '#11998e' : (color === 'orange' ? '#f5576c' : '#95a5a6'),
                        fontSize: '11px',
                        fontWeight: '600',
                        fontFamily: 'Prompt, sans-serif'
                    }
                });
                
                marker.addListener('click', () => {
                    infoWindow.setContent(createInfo(loc));
                    infoWindow.open(map, marker);
                });
                
                markers.push({ marker, label: labelMarker });
            });
            
            if (markers.length > 0) {
                map.fitBounds(bounds);
            }
        }
        
        function updateStats() {
            const total = locationsData.length;
            const surveyedOk = locationsData.filter(l => l.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß' && l.ais === '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ').length;
            const surveyedNo = locationsData.filter(l => l.status === '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß' && l.ais !== '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ').length;
            const pending = locationsData.filter(l => l.status !== '‡∏™‡∏≥‡∏£‡∏ß‡∏à‡πÅ‡∏•‡πâ‡∏ß').length;
            
            document.getElementById('totalCount').textContent = total;
            document.getElementById('surveyedOkCount').textContent = surveyedOk;
            document.getElementById('surveyedNoCount').textContent = surveyedNo;
            document.getElementById('pendingCount').textContent = pending;
        }
        
        window.initMap = initMap;
    </script>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBtMkrEmWVIp6IW6vkZ9A-7vjQKc8njTOA&callback=initMap"></script>
</body>
</html>
